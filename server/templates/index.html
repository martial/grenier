<html>
  <head>
    <title>Config</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
  </head>
  <body>

    <div id="updated">{{ updated }}</div>

    <div id="container">

        <h1>GRENIER SERVER CONFIGURATION</h1>


        <div class="col">
            
            <form method="POST" action="{{ url_for('submit_form') }}">

                <div class="row">
                    <div class="input">
                        <label for="language">Language</label>
                        <select name="language" id="language" >
                            <option value="fr" {% if language == 'fr' %} selected {% endif %}>Français</option>
                            <option value="en" {% if language == 'en' %} selected {% endif %}>English</option>
                        </select>
                    </div>    
                    <div class="input">
                        <label for="gpt_temp">GPT Temperature <span class="hint">(min=0, max=1)</span></label>
                        <input type="number" id="gpt_temp" name="gpt_temp" step=0.01 min=0 max=1 value="{{ gpt_temp }}" required>
                    </div>            
                </div>


                <div class="row">
                    <div class="input">
                        <label for="talk">Talk </label>
                        <select name="talk" id="talk" >
                            <option value="1" {% if talk  %} selected {% endif %}>Yes</option>
                            <option value="0" {% if not talk  %} selected {% endif %}>No</option>
                        </select>
                    </div>
                    <div class="input">
                        <label for="transcription_silence">Transcription Silence Time<span class="hint">(min=0.5, max=60)</span></label>
                        <input type="number" id="transcription_silence" name="transcription_silence" step=0.01 min=0.5 max=60 value="{{ transcription_silence }}" required>
                    </div>
                </div>

                <div class="row">
                    <div class="input">
                        <label for="model">Model </label>
                        <select name="model" id="model" >
                            <option value="gpt-3.5-turbo" {% if model == 'gpt-3.5-turbo' %} selected {% endif %}>gpt-3.5-turbo</option>
                            <option value="gpt-4" {% if model == 'gpt-4' %} selected {% endif %}>gpt-4</option>
                        </select>
                    </div>
                    <div class="input">
                        <label for="transcription_restart">Transcription Restart Delay <span class="hint">(min=0.1, max=1)</span></label>
                        <input type="number" id="transcription_restart" name="transcription_restart" step=0.01 min=0.1 max=1 value="{{ transcription_restart }}" required>
                    </div>
                </div>
                
                <div class="row">
                    <div class="input">
                        <label for="toggle_listen">Toggle Listen </label>
                        <select name="toggle_listen" id="toggle_listen" >
                            <option value="1" {% if toggle_listen  %} selected {% endif %}>Yes</option>
                            <option value="0" {% if not toggle_listen  %} selected {% endif %}>No</option>
                        </select>
                    </div>
                </div>

                <div class="input">
                    <label for="gpt_role">Role</label>
                    <textarea id="gpt_role" name="gpt_role" rows="4" placeholder="À partir de maintenant tu parles comme..." required>{{ gpt_role }}</textarea>
                </div>

                <div class="input">
                    <label for="gpt_context">Context</label>
                    <textarea id="gpt_context" name="gpt_context" rows="4" placeholder="Notre conversation doit prendre en compte le contexte suivant: ..." >{{ gpt_context }}</textarea>
                </div>

                <div class="input">
                    <label for="gpt_action">Action</label>
                    <textarea id="gpt_action" name="gpt_action" rows="4" >{{ gpt_action }}</textarea>
                </div>

                <div class="row">
                    <div id="update_notice">Configuration updated</div>
                    <input type="submit" value="Save">
                </div>

            </form>

        </div>


        <div class="col">
            <h3>Toggle Off Mode</h3>
            <form id="play" method="POST" action="{{ url_for('play') }}" class="{{ playing_mode }}">
                <input type="submit" value="Play">
            </form>
            <form  id="pause" method="POST" action="{{ url_for('pause') }}"  class="{{ playing_mode }}">
                <input type="submit" value="Pause">
            </form>

            <h3>Toggle On Mode</h3>
            <form id="toggle-listen-1" >
                <input id="toggle-listen-input-1" value="Toggle listen 1">
            </form>
            <form id="toggle-listen-2" >
                <input id="toggle-listen-input-2" value="Toggle listen 2">
            </form>

            <h3>General</h3>
            <form id="stop-1" >
                <input id="stop-input-1" value="Stop 1">
            </form>
            <form id="stop-2" >
                <input id="stop-input-2" value="Stop 2">
            </form>
            <form id="reset-conv-1" >
                <input id="reset-conv-input-1" value="End/Reset conversation 1">
            </form>
            <form id="reset-conv-2" >
                <input id="reset-conv-input-2" value="End/Reset conversation 2">
            </form>

        </div>

    </div>

    <script>
        var up = document.getElementById("updated").innerHTML;
        if ( up == '1') 
        {
            document.getElementById("update_notice").classList.add("show");
            setTimeout( function(){
                document.getElementById("update_notice").classList.add("hide");
                document.getElementById("update_notice").classList.remove("show");
            }, 2000);
        }

        document.getElementById("toggle-listen-input-1").addEventListener('mousedown', function()
        {
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/toggle_listen_1', true);
            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4 && xhr.status === 200) { console.log(xhr.responseText); }
            };
            xhr.send(JSON.stringify({ data: "on" }));
        });

        document.getElementById("toggle-listen-input-1").addEventListener('mouseup', function()
        {
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/toggle_listen_1', true);
            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4 && xhr.status === 200) { console.log(xhr.responseText); }
            };
            xhr.send(JSON.stringify({ data: "off" }));
        });

        document.getElementById("toggle-listen-input-2").addEventListener('mousedown', function()
        {
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/toggle_listen_2', true);
            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4 && xhr.status === 200) { console.log(xhr.responseText); }
            };
            xhr.send(JSON.stringify({ data: "on" }));
        });
        
        document.getElementById("toggle-listen-input-2").addEventListener('mouseup', function()
        {
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/toggle_listen_2', true);
            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4 && xhr.status === 200) { console.log(xhr.responseText); }
            };
            xhr.send(JSON.stringify({ data: "off" }));
        });

        document.getElementById("stop-input-1").addEventListener('click', function()
        {
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/stop_1', true);
            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4 && xhr.status === 200) { console.log(xhr.responseText); }
            };
            xhr.send();
        });
        
        document.getElementById("stop-input-2").addEventListener('mouseup', function()
        {
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/stop_2', true);
            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4 && xhr.status === 200) { console.log(xhr.responseText); }
            };
            xhr.send();
        });
        

        document.getElementById("reset-conv-input-1").addEventListener('click', function()
        {
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/reset_1', true);
            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4 && xhr.status === 200) { console.log(xhr.responseText); }
            };
            xhr.send();
        });

        document.getElementById("reset-conv-input-2").addEventListener('click', function()
        {
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/reset_2', true);
            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4 && xhr.status === 200) { console.log(xhr.responseText); }
            };
            xhr.send();
        });
    </script>
  </body>
</html>